<!-- <!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Saved Routes</title>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCX-Ukm1kWZZt1ZQnKaiteVcl2OxoCH5S8&libraries=places,geocoding"></script>
    <script>
        let map, currentLocation, destination, directionsService, directionsRenderer, geocoder;
        let currentMarker, destinationMarker;
        let alternativeRoutes = [];

        function initMap() {
            directionsService = new google.maps.DirectionsService();
            directionsRenderer = new google.maps.DirectionsRenderer();
            geocoder = new google.maps.Geocoder();

            map = new google.maps.Map(document.getElementById("map"), {
                center: { lat: 49.2827, lng: -123.1207},
                zoom: 8,
            });
            directionsRenderer.setMap(map);

            google.maps.event.addListener(map, 'click', function(event) {
                if (!currentLocation) {
                    setCurrentLocation(event.latLng);
                } else if (!destination) {
                    setDestination(event.latLng);
                } else {
                    setCurrentLocation(event.latLng);
                    setDestination(null);
                }
            });

            const inputCurrent = document.getElementById("current-location");
            const inputDestination = document.getElementById("destination");

            const autocompleteCurrent = new google.maps.places.Autocomplete(inputCurrent);
            const autocompleteDestination = new google.maps.places.Autocomplete(inputDestination);

            autocompleteCurrent.addListener('place_changed', function() {
                setCurrentLocation(autocompleteCurrent.getPlace().geometry.location);
            });

            autocompleteDestination.addListener('place_changed', function() {
                setDestination(autocompleteDestination.getPlace().geometry.location);
            });
        }

        function setCurrentLocation(location) {
            currentLocation = location;
            if (currentMarker) currentMarker.setMap(null);
            currentMarker = new google.maps.Marker({
                position: currentLocation,
                map: map,
                title: "Current Location"
            });
            map.setCenter(currentLocation);
            geocodeLocation(location, 'current-location');
        }

        function setDestination(location) {
            destination = location;
            if (destinationMarker) destinationMarker.setMap(null);
            if (location) {
                destinationMarker = new google.maps.Marker({
                    position: destination,
                    map: map,
                    title: "Destination"
                });
                map.setCenter(destination);
                geocodeLocation(location, 'destination');
            }
        }

        function geocodeLocation(location, inputId) {
            geocoder.geocode({ 'location': location }, function(results, status) {
                if (status === 'OK') {
                    if (results[0]) {
                        document.getElementById(inputId).value = results[0].formatted_address;
                    } else {
                        alert('No results found');
                    }
                } else {
                    alert('Geocoder failed due to: ' + status);
                }
            });
        }

        function calculateRoute() {
            if (!currentLocation || !destination) {
                alert("Please select both current location and destination.");
                return;
            }

            const request = {
                origin: currentLocation,
                destination: destination,
                travelMode: 'TRANSIT',
                provideRouteAlternatives: true
            };

            directionsService.route(request, function(result, status) {
                if (status === 'OK') {
                    directionsRenderer.setDirections(result);
                    displayRouteOptions(result.routes);
                } else {
                    alert("Could not retrieve route.");
                }
            });
        }

        function displayRouteOptions(routes) {
            const routesContainer = document.getElementById('routes');
            routesContainer.innerHTML = '';
            alternativeRoutes = routes;

            routes.forEach((route, index) => {
                const routeDiv = document.createElement('div');
                routeDiv.className = 'route-option';
                routeDiv.innerHTML = `
                    <input type="radio" name="route" value="${index}" id="route${index}" ${index === 0 ? 'checked' : ''}>
                    <label for="route${index}">
                        ${route.legs[0].duration.text} via ${route.summary}
                    </label>
                `;
                routeDiv.addEventListener('click', () => {
                    directionsRenderer.setRouteIndex(index);
                });
                routesContainer.appendChild(routeDiv);
            });
        }

        function clearMap() {
            if (currentMarker) currentMarker.setMap(null);
            if (destinationMarker) destinationMarker.setMap(null);
            directionsRenderer.set('directions', null);
            currentLocation = null;
            destination = null;
            document.getElementById('routes').innerHTML = '';
            document.getElementById('current-location').value = '';
            document.getElementById('destination').value = '';
        }
    </script>
    <style>
        .route-option {
            margin: 5px 0;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            cursor: pointer;
        }
        .route-option:hover {
            background-color: #f0f0f0;
        }
    </style>
</head>
<body onload="initMap()">
    <h1>Saved Routes</h1>
    <input id="current-location" type="text" placeholder="Enter current location">
    <input id="destination" type="text" placeholder="Enter destination">
    <button onclick="calculateRoute()">Get Route</button>
    <button onclick="clearMap()">Clear Map</button>
    <div id="routes"></div>
    <div id="map" style="height: 500px; width: 100%;"></div>
</body>
</html>

 -->



 <!-- version 2 -->
 <!-- <!DOCTYPE html>
 <html xmlns:th="http://www.thymeleaf.org">
 <head>
     <title>Saved Routes</title>
     <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCX-Ukm1kWZZt1ZQnKaiteVcl2OxoCH5S8&libraries=places,geocoding"></script>
     <script>
         let map, currentLocation, destination, directionsService, directionsRenderer, geocoder;
         let currentMarker, destinationMarker;
         let alternativeRoutes = [];
 
         function initMap() {
             directionsService = new google.maps.DirectionsService();
             directionsRenderer = new google.maps.DirectionsRenderer();
             geocoder = new google.maps.Geocoder();
 
             map = new google.maps.Map(document.getElementById("map"), {
                 center: { lat: 49.2827, lng: -123.1207 },
                 zoom: 8,
             });
             directionsRenderer.setMap(map);
 
             google.maps.event.addListener(map, 'click', function(event) {
                 if (!currentLocation) {
                     setCurrentLocation(event.latLng);
                 } else if (!destination) {
                     setDestination(event.latLng);
                 } else {
                     setCurrentLocation(event.latLng);
                     setDestination(null);
                 }
             });
 
             const inputCurrent = document.getElementById("current-location");
             const inputDestination = document.getElementById("destination");
 
             const autocompleteCurrent = new google.maps.places.Autocomplete(inputCurrent);
             const autocompleteDestination = new google.maps.places.Autocomplete(inputDestination);
 
             autocompleteCurrent.addListener('place_changed', function() {
                 setCurrentLocation(autocompleteCurrent.getPlace().geometry.location);
             });
 
             autocompleteDestination.addListener('place_changed', function() {
                 setDestination(autocompleteDestination.getPlace().geometry.location);
             });
         }
 
         function setCurrentLocation(location) {
             currentLocation = location;
             if (currentMarker) currentMarker.setMap(null);
             currentMarker = new google.maps.Marker({
                 position: currentLocation,
                 map: map,
                 title: "Current Location"
             });
             map.setCenter(currentLocation);
             geocodeLocation(location, 'current-location');
         }
 
         function setDestination(location) {
             destination = location;
             if (destinationMarker) destinationMarker.setMap(null);
             if (location) {
                 destinationMarker = new google.maps.Marker({
                     position: destination,
                     map: map,
                     title: "Destination"
                 });
                 map.setCenter(destination);
                 geocodeLocation(location, 'destination');
             }
         }
 
         function geocodeLocation(location, inputId) {
             geocoder.geocode({ 'location': location }, function(results, status) {
                 if (status === 'OK') {
                     if (results[0]) {
                         document.getElementById(inputId).value = results[0].formatted_address;
                     } else {
                         alert('No results found');
                     }
                 } else {
                     alert('Geocoder failed due to: ' + status);
                 }
             });
         }
 
         function calculateRoute(mode) {
             if (!currentLocation || !destination) {
                 alert("Please select both current location and destination.");
                 return;
             }
 
             const request = {
                 origin: currentLocation,
                 destination: destination,
                 travelMode: mode,
                 provideRouteAlternatives: true
             };
 
             directionsService.route(request, function(result, status) {
                 if (status === 'OK') {
                     directionsRenderer.setDirections(result);
                     displayRouteOptions(result.routes);
                 } else {
                     alert("Could not retrieve route.");
                 }
             });
         }
 
         function calculateBestRoute() {
             const modes = ['TRANSIT', 'DRIVING', 'WALKING', 'BICYCLING'];
             let bestRoute = null;
             let bestDuration = Infinity;
 
             const checkNextMode = () => {
                 if (modes.length === 0) {
                     if (bestRoute) {
                         directionsRenderer.setDirections(bestRoute);
                         displayRouteOptions(bestRoute.routes);
                     } else {
                         alert("Could not retrieve route.");
                     }
                     return;
                 }
 
                 const mode = modes.shift();
                 const request = {
                     origin: currentLocation,
                     destination: destination,
                     travelMode: mode,
                     provideRouteAlternatives: true
                 };
 
                 directionsService.route(request, function(result, status) {
                     if (status === 'OK') {
                         const routeDuration = result.routes[0].legs[0].duration.value; // duration in seconds
                         if (routeDuration < bestDuration) {
                             bestDuration = routeDuration;
                             bestRoute = result;
                         }
                     }
                     checkNextMode();
                 });
             };
 
             checkNextMode();
         }
 
         function displayRouteOptions(routes) {
             const routesContainer = document.getElementById('routes');
             routesContainer.innerHTML = '';
             alternativeRoutes = routes;
 
             routes.forEach((route, index) => {
                 const routeDiv = document.createElement('div');
                 routeDiv.className = 'route-option';
                 routeDiv.innerHTML = `
                     <input type="radio" name="route" value="${index}" id="route${index}" ${index === 0 ? 'checked' : ''}>
                     <label for="route${index}">
                         ${route.legs[0].duration.text} via ${route.summary}
                     </label>
                 `;
                 routeDiv.addEventListener('click', () => {
                     directionsRenderer.setRouteIndex(index);
                 });
                 routesContainer.appendChild(routeDiv);
             });
         }
 
         function clearMap() {
             if (currentMarker) currentMarker.setMap(null);
             if (destinationMarker) destinationMarker.setMap(null);
             directionsRenderer.set('directions', null);
             currentLocation = null;
             destination = null;
             document.getElementById('routes').innerHTML = '';
             document.getElementById('current-location').value = '';
             document.getElementById('destination').value = '';
         }
     </script>
     <style>
         .route-option {
             margin: 5px 0;
             padding: 10px;
             border: 1px solid #ccc;
             border-radius: 5px;
             cursor: pointer;
         }
         .route-option:hover {
             background-color: #f0f0f0;
         }
     </style>
 </head>
 <body onload="initMap()">
     <h1>Saved Routes</h1>
     <input id="current-location" type="text" placeholder="Enter current location">
     <input id="destination" type="text" placeholder="Enter destination">
     <button onclick="calculateRoute('DRIVING')">Car Route</button>
     <button onclick="calculateRoute('WALKING')">Walking Route</button>
     <button onclick="calculateRoute('BICYCLING')">Bicycling Route</button>
     <button onclick="calculateRoute('TRANSIT')">Transit Route</button>
     <button onclick="calculateBestRoute()">Best Route</button>
     <button onclick="clearMap()">Clear Map</button>
     <div id="routes"></div>
     <div id="map" style="height: 500px; width: 100%;"></div>
 </body>
 </html>



     -->


<!-- version 3 -->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Saved Routes</title>
    <script src="https://maps.googleapis.com/maps/api/js?key=API_KEY&libraries=places,geocoding"></script>
    <script>
        let map, currentLocation, destination, directionsService, directionsRenderer, geocoder, travelMode;
        let currentMarker, destinationMarker;
        let alternativeRoutes = [];
        let selectedRoute = null;

        function initMap() {
            directionsService = new google.maps.DirectionsService();
            directionsRenderer = new google.maps.DirectionsRenderer();
            geocoder = new google.maps.Geocoder();

            map = new google.maps.Map(document.getElementById("map"), {
                center: { lat: 49.2827, lng: -123.1207 },
                zoom: 8,
            });
            directionsRenderer.setMap(map);

            google.maps.event.addListener(map, 'click', function (event) {
                if (!currentLocation) {
                    setCurrentLocation(event.latLng);
                } else if (!destination) {
                    setDestination(event.latLng);
                } else {
                    setCurrentLocation(event.latLng);
                    setDestination(null);
                }
            });

            const inputCurrent = document.getElementById("current-location");
            const inputDestination = document.getElementById("destination");

            const autocompleteCurrent = new google.maps.places.Autocomplete(inputCurrent);
            const autocompleteDestination = new google.maps.places.Autocomplete(inputDestination);

            autocompleteCurrent.addListener('place_changed', function () {
                setCurrentLocation(autocompleteCurrent.getPlace().geometry.location);
            });

            autocompleteDestination.addListener('place_changed', function () {
                setDestination(autocompleteDestination.getPlace().geometry.location);
            });
        }

        function setCurrentLocation(location) {
            currentLocation = location;
            if (currentMarker) currentMarker.setMap(null);
            currentMarker = new google.maps.Marker({
                position: currentLocation,
                map: map,
                title: "Current Location"
            });
            map.setCenter(currentLocation);
            geocodeLocation(location, 'current-location');
        }

        function setDestination(location) {
            destination = location;
            if (destinationMarker) destinationMarker.setMap(null);
            if (location) {
                destinationMarker = new google.maps.Marker({
                    position: destination,
                    map: map,
                    title: "Destination"
                });
                map.setCenter(destination);
                geocodeLocation(location, 'destination');
            }
        }

        function geocodeLocation(location, inputId) {
            geocoder.geocode({ 'location': location }, function (results, status) {
                if (status === 'OK') {
                    if (results[0]) {
                        document.getElementById(inputId).value = results[0].formatted_address;
                    } else {
                        alert('No results found');
                    }
                } else {
                    alert('Geocoder failed due to: ' + status);
                }
            });
        }

        function calculateRoute(mode) {
            if (!currentLocation || !destination) {
                alert("Please select both current location and destination.");
                return;
            }

            travelMode = mode.toLowerCase();

            const request = {
                origin: currentLocation,
                destination: destination,
                travelMode: mode,
                provideRouteAlternatives: true
            };

            directionsService.route(request, function (result, status) {
                if (status === 'OK') {
                    directionsRenderer.setDirections(result);
                    selectedRoute = result.routes[0];
                    displayRouteOptions(result.routes);
                } else {
                    alert("Could not retrieve route.");
                }
            });
        }

        function displayRouteOptions(routes) {
            const routesContainer = document.getElementById('routes');
            routesContainer.innerHTML = '';
            alternativeRoutes = routes;

            routes.forEach((route, index) => {
                const routeDiv = document.createElement('div');
                routeDiv.className = 'route-option';
                routeDiv.innerHTML = `
                        <input type="radio" name="route" value="${index}" id="route${index}" ${index === 0 ? 'checked' : ''}>
                        <label for="route${index}">
                            ${route.legs[0].duration.text} via ${route.summary}
                        </label>
                    `;
                routeDiv.addEventListener('click', () => {
                    directionsRenderer.setRouteIndex(index);
                    selectedRoute = routes[index];
                });
                routesContainer.appendChild(routeDiv);
            });
        }

        function clearMap() {
            if (currentMarker) currentMarker.setMap(null);
            if (destinationMarker) destinationMarker.setMap(null);
            directionsRenderer.set('directions', null);
            currentLocation = null;
            destination = null;
            selectedRoute = null;
            document.getElementById('routes').innerHTML = '';
            document.getElementById('current-location').value = '';
            document.getElementById('destination').value = '';
        }

        function saveRoute() {
            if (!currentLocation || !destination) {
                alert("Please select both current location and destination.");
                return;
            }

            const startPoint = document.getElementById('current-location').value;
            const endPoint = document.getElementById('destination').value;
            // const travelMode = document.querySelector('input[name="route"]:checked').value;
            const routeDetails = JSON.stringify(directionsRenderer.getDirections());

            fetch('/save-route', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: new URLSearchParams({
                    'startCoords': currentLocation,
                    'endCoords': destination,
                    'startPoint': startPoint,
                    'endPoint': endPoint,
                    'travelMode': travelMode,
                    'routeDetails': routeDetails
                })
            })
            .then(response => {
                if (response.ok) {
                    alert('Route saved successfully.');
                } else {
                    alert('Failed to save route.');
                }
            })
            .catch((error) => {
                console.error('Error:', error);
            });
        }
    </script>
    <style>
        .route-option {
            margin: 5px 0;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            cursor: pointer;
        }
    
        .route-option:hover {
            background-color: #f0f0f0;
        }
    </style>
</head>
<body onload="initMap()">
    <h1>search your routes</h1>
    <input id="current-location" type="text" placeholder="Enter current location">
    <input id="destination" type="text" placeholder="Enter destination">
    <button onclick="calculateRoute('DRIVING')">Car Route</button>
    <button onclick="calculateRoute('WALKING')">Walking Route</button>
    <button onclick="calculateRoute('BICYCLING')">Bicycling Route</button>
    <button onclick="calculateRoute('TRANSIT')">Transit Route</button>
    <button onclick="calculateRoute('FLYING')">Flying Route</button>
    <!-- <button onclick="calculateBestRoute()">Best Route</button> -->
    <button onclick="clearMap()">Clear Map</button>
    <button onclick="saveRoute()">Save This Route</button>
    <div id="routes"></div>
    <div id="map" style="height: 500px; width: 100%;"></div>
    <a href="/saved-routes">See Your Saved Routes</a>
</body>
</html>
